
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MySQL - 艾丽莎的个人小屋</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="                                                                                                   ,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="艾丽莎的个人小屋" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    <meta name="twitter:image:src" content="https://bangdream.moe/img/ident.png"/>
    <meta name="twitter:creator" content="@yourtwitteridhere"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="MySQL - 艾丽莎的个人小屋"/>
    <meta name="twitter:description" content="                                                                                                   ,"/>
    <meta property="og:image" content="https://bangdream.moe/img/ident.png"/>
    <meta property="og:image:alt" content="                                                                                                   ,"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="600"/>
    <meta property="og:site_name" content="艾丽莎的个人小屋"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="MySQL - 艾丽莎的个人小屋"/>
    <meta property="og:description" content="                                                                                                   ,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>window.searchDbPath = "/search.xml";</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="loading">
    <span id="config-title" style="display:none">艾丽莎的个人小屋</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">MySQL</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">MySQL</h1>
        <div class="stuff">
            <span>三月 05, 2023</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3MySQL/" rel="tag">深入了解MySQL</a></li></ul>


        </div>
        <div class="content markdown">
            <pre><code>                                                                                                                                                                                                                        ..
</code></pre>
<h4 id="1-读写分离"><a href="#1-读写分离" class="headerlink" title="1.读写分离"></a>1.读写分离</h4><p>主从架构，主节点负责写数据，从节点负责读取数据</p>
<h4 id="2-分库分表"><a href="#2-分库分表" class="headerlink" title="2.分库分表"></a>2.分库分表</h4><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/0NXsi1J0OqVQ7lk24b0p9Q">https://mp.weixin.qq.com/s/0NXsi1J0OqVQ7lk24b0p9Q</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/x2PT6lV8jZgrb0jzi6TIvg">https://mp.weixin.qq.com/s/x2PT6lV8jZgrb0jzi6TIvg</a></p>
<h4 id="3-SQL优化"><a href="#3-SQL优化" class="headerlink" title="3.SQL优化"></a>3.SQL优化</h4><p>1)加索引+索引使用原则(哪些情况索引失效)<br>2)如果知道要返回的数据有n条 可以使用limit n<br>3)只返回需要的字段 不用select *<br>4)尽量避免使用子查询<br>5)用in 代替or<br>6)优化group by<br>如果对排序没有要求，那么可以order by null，进行group by时会对group by的字段进行order by<br>用where代替having，having只会在检索出所有记录才对结果集进行过滤<br>7)多次插入改为批量插入<br>8)exists适合于外表小 内表大 先查询外表，in适合外表大 内表小 先查询内表<br>select * from a where id in (select id from b) 括号是内表<br>9)尽量使用数据型字段<br>数据型字段进行匹配时只需要一次，而字符串形式字段需要对每个字符进行匹配<br>10)优化join连接<br>执行join时会对两个表进行比较<br>可以用记录数少的表作为驱动表，记录数多的作为被驱动表，左连接时对右表设置索引<br>当不带where条件<br>a left join b  a是前驱表 a right join b b是前驱表 a inner join b 数据少的是前驱表<br>a straight_join b  左表为前驱表  带where条件  带where条件的表是驱动表</p>
<h4 id="4-b-树高频率操作增删后会发生什么"><a href="#4-b-树高频率操作增删后会发生什么" class="headerlink" title="4.b+树高频率操作增删后会发生什么"></a>4.b+树高频率操作增删后会发生什么</h4><p>mysql碎片 页分裂 磁盘io</p>
<h4 id="5-innodb和myisam区别"><a href="#5-innodb和myisam区别" class="headerlink" title="5.innodb和myisam区别"></a>5.innodb和myisam区别</h4><p>innodb支持事务及事务四种隔离级别，myisam不支持事务 但每次操作都是原子性的<br>innodb支持外键，myisam不支持<br>innodb是聚簇索引，myisam是非聚簇索引<br>innodb支持行锁和表锁，但是可能因为范围而锁表，myisam支持表锁<br>innodb不存储总行数，myisam存储总行数<br>innodb适合增删改查，myisam适合大量查询</p>
<h4 id="6-MySQL索引结构-为什么使用B-tree而不用B树"><a href="#6-MySQL索引结构-为什么使用B-tree而不用B树" class="headerlink" title="6.MySQL索引结构 为什么使用B+tree而不用B树"></a>6.MySQL索引结构 为什么使用B+tree而不用B树</h4><p>(1)B+ 树的非叶子节点不存放实际的记录数据，仅存放索引，因此数据量相同的情况下，相比存储即存索引又存记<br>录的 B 树，B+树的非叶子节点可以存放更多的索引，因此 B+ 树可以比 B 树更「矮胖」，查询底层节点的磁盘<br>I&#x2F;O次数会更少。<br>(2)B+ 树有大量的冗余节点（所有非叶子节点都是冗余索引），这些冗余索引让 B+ 树在插入、删除的效率都更高，比如删除根节点的时候，不会像 B 树那样会发生复杂的树的变化；<br>(3)B+ 树叶子节点之间用链表连接了起 来，有利于范围查询，而 B 树要实现 范围查询，因此只能通过树的遍历来完成范围查询，这会涉及多个节点的磁盘 I&#x2F;O 操作，范围查询效率不如 B+ 树。</p>
<h4 id="7-索引类型"><a href="#7-索引类型" class="headerlink" title="7.索引类型"></a>7.索引类型</h4><p><strong>主键索引(primary key)</strong><br>主键索引是唯一且非空的索引，它确保了表中数据的唯一性，并且一个表只能有一个主键索引，其他索引为非主键索引 也叫二级索引<br><strong>唯一索引(unique)</strong><br>唯一索引要求索引列中的值必须是唯一的，但它允许NULL值的存在。这种索引通常用于确保数据列的唯一性<br><strong>普通索引</strong>: 允许在定义索引的列中插入重复值和NULL值。一个表可以有多个普通索引<br><strong>全文索引(fulltext):</strong> 支持全文搜索，它可以在文本类型的列上创建，以便快速检索文章或报告中的关键词<br><strong>单列索引:</strong> 单列索引是只在单个列上创建的索引，它可以提高基于该列的查询效率<br><strong>多列索引:</strong> 多列索引又称为组合索引、复合索引，它是在多个列上创建的索引，可以提高涉及这些列的查询效率<br><strong>聚簇索引:</strong>  聚簇索引决定了数据在磁盘上的物理存储顺序，是一种数据存储方式。通常与主键索引一起使用，一般		   建表会用一个自增主键做聚簇索引，没有的话MySQL会默认创建</p>
<h4 id="8-聚簇索引和非聚簇索引和覆盖索引"><a href="#8-聚簇索引和非聚簇索引和覆盖索引" class="headerlink" title="8.聚簇索引和非聚簇索引和覆盖索引"></a>8.聚簇索引和非聚簇索引和覆盖索引</h4><p><strong>聚簇索引</strong>就是叶子节点存储索引和数据，InnoDB就属于聚簇索引<br><strong>非聚簇索引</strong>就是叶子节点存储索引和磁盘地址，通过磁盘地址找到存储的数据,需要回表操作所以效率比聚簇索引慢,MylSAM就属于非聚簇索引<br><strong>覆盖索引</strong>就是查询字段包含索引的所有字段</p>
<h4 id="9-建立索引的方式"><a href="#9-建立索引的方式" class="headerlink" title="9.建立索引的方式"></a><strong>9.建立索引的方式</strong></h4><p>1)alter table 表名 add 索引类型(字段)<br>2)create 索引类型 索引名 on 表名(字段)<br>3)创建表时直接添加<br>create table students(<br>    id int primary key，<br>    name varchar(20)，<br>索引类型 idx_students_name (name)<br>)</p>
<h4 id="10-where和having的区别"><a href="#10-where和having的区别" class="headerlink" title="10.where和having的区别"></a><strong>10.where和having的区别</strong></h4><p>where在数据分组和聚合之前对单行记录进行过滤   where不能直接使用聚合函数(sum avg)<br>having则在数据分组和聚合之后对分组结果进行过滤，且可以使用聚合函数</p>
<h4 id="11-创建索引的字段"><a href="#11-创建索引的字段" class="headerlink" title="11.创建索引的字段"></a><strong>11.创建索引的字段</strong></h4><p>1)主键<br>2)经常出现在where字句的字段，即常被作为查询条件 分组条件 排序条件的字段<br>3)针对数据量大，且查询比较频繁的表建立索引<br>4)选择区分度高的字段，即该字段在表中的值大多是不相同的<br>5)选择小字段<br>6)经常与其他表进行连表查询，在连接字段上可以建立索引<br>7)如果是字符串类型的字段，字段的长度较长，可以针对字符串的特点，建立前缀索引<br>为student表的name字段创建长度为3的前缀索引  create index idx_student_name on student(name(3)) </p>
<h4 id="12-如何确定语句是否走索引"><a href="#12-如何确定语句是否走索引" class="headerlink" title="12.如何确定语句是否走索引"></a><strong>12.如何确定语句是否走索引</strong></h4><p>通过使用explain命令分析执行计划，查看type列是否为all，all代表全表扫描，查看key列是否为null 为null代表没有走索引</p>
<h4 id="13-建立联合索引-字段顺序需要注意"><a href="#13-建立联合索引-字段顺序需要注意" class="headerlink" title="13.建立联合索引 字段顺序需要注意"></a>13.建立联合索引 字段顺序需要注意</h4><p>1)最左匹配原则 最常用的字段放在最左边<br>2)等值条件字段放左边<br>3)区分度高的字段放左边，即在表中的值大多不同的字段</p>
<h4 id="14-b-tree索引和哈希索引"><a href="#14-b-tree索引和哈希索引" class="headerlink" title="14.b+tree索引和哈希索引"></a>14.b+tree索引和哈希索引</h4><h4 id="15-建立索引原则"><a href="#15-建立索引原则" class="headerlink" title="15.建立索引原则"></a>15.建立索引原则</h4><p>(1)选择字段不为null，区分度高的字段，即在表中的值大多不同的字段被频繁查询的字段<br>(2)作为查询条件 分组条件 排序条件的字段<br>(3)频繁用于连接的字段<br>(4)尽量建立联合索引<br>(5)尽量扩展索引而不创建新的索引</p>
<h4 id="16-索引失效情况"><a href="#16-索引失效情况" class="headerlink" title="16.索引失效情况"></a>16.索引失效情况</h4><p>(1)不遵循最左匹配原则<br>(2)组合索引中间没有用到<br>(3)在索引列上使用函数 表达式 类型转换<br>(4)以%开头的like查找<br>(5)索引字段使用 is null 或者 is not null<br>(6)索引字段用!&#x3D;或&lt; &gt; 或 not in<br>(7)使用select *，使用select * 不会直接导致索引失效,如果不走索引就是 where查询范围过大 导致MySQL 最优选择全表扫描了 并不是Select * 的问题<br>(8)条件查询使用or，且or的前后条件有一个没有用到索引列<br>(9)in的取值范围太大<br>(10)发生隐式转换 当操作符两边的数据类型不同时会进行类型转换<br>字符串转换为数值类型时，非数字开头的字符串会转化为0，以数字开头的字符串会截取从第一个字符到第一个非数字内容为止的值为转化结果<br>(11)如果需要进行 join 的字段两表的字段类型要相同</p>
<h4 id="17-MVCC"><a href="#17-MVCC" class="headerlink" title="17.MVCC"></a>17.MVCC</h4><p>多版本并发控制，用于保证多个事务同时读写数据库时不需要加锁来保证数据的一致性和隔离性<br>在每行记录后面保存三个隐藏的列，分别为行标识、事务id、回滚指针。实际为两个系统版本号。<br>当一个事务要对数据库进行修改时，mvcc会为当前事务创建一个数据快照而不是直接修改数据<br>当一个事务对数据库进行读取时会使用快照读，读取数据会根据对应的数据版本进行查询，如果读取的数据有多个版本号，那么会找到不晚于开始时间的最新版本。快照读不会受到其他修复事务影响<br>当一个事务对数据库进行修改时会生成新的数据版本，并将修改的数据写入。为修改的数据创建一个新的版本号并将修改后的数据写入新版本，原始版本数据仍然存在，不影响其他事务读取<br><strong>事务提交和回滚</strong><br>事务提交将数据修改为最新版本并对其他事务可见  事务回滚将对数据的修改撤销并对其他事务不可见<br><strong>版本回收</strong><br>mvcc会定期对数据版本进行回收，删除不需要的旧版本数据,mvcc适用于可重复读和读已提交<br>MVCC 通过创建数据的多个版本和使用快照读取来实现并发控制。读操作使用旧版本数据的快照，写操作创建新版本，并确保原始版本仍然可用。这样，不同的事务可以在一定程度上并发执行，而不会相互干扰，从而提高了数据库的并发性能和数据一致性。<br>总结:InnoDB的MVCC是通过readview和版本链实现的，版本链保存有历史版本记录，通过read view判断当前版本的数据是否可见，如果不可见，再从版本链中找到上一个版本，继续进行判断，直到找到一个可见的版本。</p>
<h4 id="18-数据库数据隐藏的列"><a href="#18-数据库数据隐藏的列" class="headerlink" title="18.数据库数据隐藏的列"></a>18.数据库数据隐藏的列</h4><p><strong>行标识 row_id</strong><br>如果在表中存在主键或非空唯一索引，并且只由整数类型组成，那么row_id直接引用主键或非空唯一索引的值，可以使用select _rowid查询 如果没有设置主键且该表没有唯一非空索引时，InnoDB 会使用该 id 来生成聚簇索引<br><strong>事务id trx_id</strong><br>表示最后一次插入或更新该行的事务 id<br><strong>回滚指针  rollback_pointer</strong><br>回滚指针，指向该行的 undo log 。如果该行未被更新，则为空</p>
<h4 id="19-隔离级别"><a href="#19-隔离级别" class="headerlink" title="19.隔离级别"></a>19.隔离级别</h4><p>**读未提交(脏读 不可重复读 幻读 )**：允许读取尚未提交的数据变更<br>**读已提交(不可重复读 幻读)**：允许读取并发事务已经提交的数据<br>**可重复读(幻读)**：对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改<br><strong>可串行化</strong>：最高的隔离级别，完全服从 ACID 的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能		   产生干扰，所有读写操作都需要</p>
<p><strong>丢失修改（脏写）</strong><br>在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改</p>
<p><strong>幻读</strong> ：幻读的重点在于记录新增比如多次执行同一条查询语句（DQL）时，发现查到的记录增加了</p>
<p><strong>不可重复读</strong> ：不可重复读的重点是内容修改或者记录减少比如多次读取一条记录发现其中某些记录的值被修改</p>
<p><strong>脏读</strong>：读取到没有被提交的数据</p>
<h4 id="20-事务的特点"><a href="#20-事务的特点" class="headerlink" title="20.事务的特点"></a>20.事务的特点</h4><p><strong>原子性：</strong>事务的操作要么都成功，要么都失败<br><strong>一致性</strong>：数据在事务的开始到结束的过程中要保持一致<br><strong>隔离性</strong>：每个事务之间相互隔离<br><strong>持久性</strong>：事务完成后数据会被持久化</p>
<h4 id="21-分布式事务"><a href="#21-分布式事务" class="headerlink" title="21.分布式事务"></a>21.分布式事务</h4><p>分布式事务是指在分布式环境下，不同服务之间互相调用需要保证数据一致性，本质就是保证不同数据库的数据一致性，因为不同服务之间的数据库都是互相独立的</p>
<h4 id="22-数据库表设计"><a href="#22-数据库表设计" class="headerlink" title="22.数据库表设计"></a>22.数据库表设计</h4><h4 id="23-MySQL底层使用B-树而不用B树"><a href="#23-MySQL底层使用B-树而不用B树" class="headerlink" title="23.MySQL底层使用B+树而不用B树"></a>23.MySQL底层使用B+树而不用B树</h4><p>1)b+tree特点<br>高度平衡  范围查询友好  大容量索引  聚簇索引与非聚簇索引<br>2)B+树与 B 树相比，具备更少的 IO 次数、更稳定的查询效率和更适于范围查询的优势<br>B+树中间节点不存数据只存索引。而B树中间节点存储数据<br>B+树每次需查询到叶子节点，性能稳定，而B树查找只需要找到匹配的元素，最好情况下找到根结点，最坏找到叶子节点，性能不稳定<br>B+树范围查询优势明显。首先通过二分查找，找到范围下限，然后同过叶子结点的链表顺序遍历，直至找到上限即可。<br>B树首先二分查找到范围下限，在不断通过中序遍历，直到查找到范围的上限才行。</p>
<h4 id="24-b-tree的查找过程"><a href="#24-b-tree的查找过程" class="headerlink" title="24.b+tree的查找过程"></a>24.b+tree的查找过程</h4><p>起始于根节点，自顶向下遍历树，在节点内部典型的使用是二分查找来确定这个位置。</p>
<h4 id="25-innodb存储引擎结构"><a href="#25-innodb存储引擎结构" class="headerlink" title="25.innodb存储引擎结构"></a>25.innodb存储引擎结构</h4><p>表空间：所有数据都存在表空间中，表空间分系统表空间和独立表空间。<br>段：表空间由段组成，一张表通常有数据段、回滚段、索引段等，每个段由N个区和32个零散的页组成<br>区：由连续的页组成，每个区固定大小为1MB<br>页：一个区由64个连续页组成，页默认大小16KB</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
        
    <div id="gitalk-container" class="comment link"
		data-enable="false"
        data-ae="false"
        data-ci=""
        data-cs=""
        data-r=""
        data-o=""
        data-a=""
        data-d="false"
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
